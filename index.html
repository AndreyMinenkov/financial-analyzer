<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Финансовый анализ: Поступления и остатки</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-chart-line"></i> Финансовый аналитик</h1>
            <p class="subtitle">Анализ поступлений и остатков на счетах</p>
        </header>

        <nav class="main-nav">
            <button class="nav-btn active" data-page="upload">
                <i class="fas fa-upload"></i> Загрузка выписок
            </button>
            <button class="nav-btn" data-page="receipts">
                <i class="fas fa-money-bill-wave"></i> Поступления
            </button>
            <button class="nav-btn" data-page="balances">
                <i class="fas fa-piggy-bank"></i> Остатки
            </button>
        </nav>

        <div class="page-content">
            <!-- Страница загрузки выписок -->
            <div id="upload-page" class="page active">
                <div class="section">
                    <h2><i class="fas fa-file-upload"></i> Загрузка банковских выписок</h2>
                    <p class="section-description">Загрузите выписки в форматах .txt, .1c, .csv. Данные будут использованы на всех страницах.</p>

                    <div class="upload-area">
                        <div class="upload-box" id="dropArea">
                            <i class="fas fa-cloud-upload-alt fa-3x"></i>
                            <h3>Перетащите файлы сюда</h3>
                            <p>или</p>
                            <button class="btn btn-primary" id="selectFilesBtn">
                                <i class="fas fa-folder-open"></i> Выберите файлы
                            </button>
                            <p class="formats">Поддерживаемые форматы: .txt, .1c, .csv</p>
                        </div>

                        <div class="file-list" id="fileList">
                            <h4>Загруженные файлы:</h4>
                            <div class="file-list-content" id="fileListContent">
                                <p class="empty-message">Файлы не загружены</p>
                            </div>
                        </div>
                    </div>

                    <div class="upload-controls">
                        <button class="btn btn-success" id="processFilesBtn">
                            <i class="fas fa-cogs"></i> Обработать файлы
                        </button>
                        <button class="btn btn-danger" id="clearFilesBtn">
                            <i class="fas fa-trash"></i> Очистить список
                        </button>
                    </div>

                    <div class="upload-stats" id="uploadStats">
                        <div class="stat-item">
                            <span class="stat-label">Файлов загружено:</span>
                            <span class="stat-value" id="filesCount">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Операций найдено:</span>
                            <span class="stat-value" id="operationsCount">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Счетов найдено:</span>
                            <span class="stat-value" id="accountsCount">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Страница поступлений -->
            <div id="receipts-page" class="page">
                <div class="section">
                    <h2><i class="fas fa-money-bill-wave"></i> Анализ поступлений</h2>
                    <p class="section-description">Анализ входящих платежей на счета компаний группы</p>

                    <div class="controls-row">
                        <div class="control-group">
                            <label for="innFileUpload">
                                <i class="fas fa-id-card"></i> Загрузить ИНН организаций
                            </label>
                            <input type="file" id="innFileUpload" accept=".txt,.csv,.xlsx" style="display: none;">
                            <button class="btn btn-secondary" id="innUploadBtn">
                                <i class="fas fa-upload"></i> Выбрать файл
                            </button>
                        </div>

                        <div class="filters">
                            <input type="text" id="searchReceipts" placeholder="Поиск по назначению или контрагенту...">
                            <button class="btn btn-outline" id="clearSearchBtn">
                                <i class="fas fa-times"></i> Очистить поиск
                            </button>
                        </div>

                        <div class="actions">
                            <button class="btn btn-primary" id="exportReceiptsBtn">
                                <i class="fas fa-file-excel"></i> Экспорт
                            </button>
                            <button class="btn btn-secondary" id="refreshReceiptsBtn">
                                <i class="fas fa-sync"></i> Обновить
                            </button>
                        </div>
                    </div>

                    <div class="table-container">
                        <table id="receiptsTable" class="data-table">
                            <thead>
                                <tr>
                                    <th>Заказчик</th>
                                    <th>ИНН заказчика</th>
                                    <th>Юридическое лицо</th>
                                    <th>Счет получателя</th>
                                    <th>Сумма</th>
                                    <th>Банк получателя</th>
                                    <th>Назначение платежа</th>
                                    <th>Дата</th>
                                </tr>
                            </thead>
                            <tbody id="receiptsTableBody">
                                <tr class="empty-row">
                                    <td colspan="8">Загрузите выписки на странице "Загрузка выписок"</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="table-footer">
                        <div class="summary">
                            <span class="summary-label">Всего поступлений:</span>
                            <span class="summary-value" id="totalReceiptsCount">0</span>
                            <span class="summary-label">Общая сумма:</span>
                            <span class="summary-value" id="totalReceiptsAmount">0,00 ₽</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Страница остатков -->
            <div id="balances-page" class="page">
                <div class="section">
                    <h2><i class="fas fa-piggy-bank"></i> Остатки на счетах</h2>
                    <p class="section-description">Анализ остатков средств на счетах и расчет процентов по депозитам</p>

                    <div class="controls-row">
                        <div class="control-group">
                            <label for="depositFileUpload">
                                <i class="fas fa-percentage"></i> Загрузить данные по депозитам
                            </label>
                            <input type="file" id="depositFileUpload" accept=".xlsx,.xls,.txt,.csv" style="display: none;">
                            <button class="btn btn-secondary" id="depositUploadBtn">
                                <i class="fas fa-upload"></i> Выбрать файл
                            </button>
                        </div>

                        <div class="date-controls">
                            <label>Дата расчета:</label>
                            <input type="date" id="calculationDate" value="">
                        </div>

                        <div class="actions">
                            <button class="btn btn-primary" id="exportBalancesBtn">
                                <i class="fas fa-file-excel"></i> Экспорт
                            </button>
                            <button class="btn btn-success" id="calculateInterestsBtn">
                                <i class="fas fa-calculator"></i> Рассчитать проценты
                            </button>
                        </div>
                    </div>

                    <div class="table-container">
                        <table id="balancesTable" class="data-table">
                            <thead>
                                <tr>
                                    <th>Компания</th>
                                    <th>Банк</th>
                                    <th>Счёт</th>
                                    <th>Остаток по выписке</th>
                                    <th>Депозит</th>
                                    <th>Ставка, %</th>
                                    <th>Проценты</th>
                                    <th>Реальный остаток</th>
                                    <th>Дата выписки</th>
                                </tr>
                            </thead>
                            <tbody id="balancesTableBody">
                                <tr class="empty-row">
                                    <td colspan="9">Загрузите выписки на странице "Загрузка выписок"</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="table-footer">
                        <div class="summary">
                            <span class="summary-label">Всего счетов:</span>
                            <span class="summary-value" id="totalAccountsCount">0</span>
                            <span class="summary-label">Общий остаток:</span>
                            <span class="summary-value" id="totalBalanceAmount">0,00 ₽</span>
                            <span class="summary-label">Общие проценты:</span>
                            <span class="summary-value" id="totalInterestsAmount">0,00 ₽</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>Финансовый аналитик © 2024 | Версия 1.0</p>
        </footer>
    </div>

    <!-- Модальное окно для редактирования депозита -->
    <div id="depositModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Редактирование депозита</h3>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <form id="depositForm">
                    <div class="form-group">
                        <label for="editCompany">Компания:</label>
                        <input type="text" id="editCompany" readonly>
                    </div>
                    <div class="form-group">
                        <label for="editAccount">Счет:</label>
                        <input type="text" id="editAccount" readonly>
                    </div>
                    <div class="form-group">
                        <label for="editDepositAmount">Сумма депозита:</label>
                        <input type="number" id="editDepositAmount" step="0.01" placeholder="0,00">
                    </div>
                    <div class="form-group">
                        <label for="editInterestRate">Ставка, %:</label>
                        <input type="number" id="editInterestRate" step="0.01" placeholder="0,00">
                    </div>
                    <div class="form-group">
                        <label for="editStartDate">Дата начала депозита:</label>
                        <input type="date" id="editStartDate">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary close-modal">Отмена</button>
                <button class="btn btn-primary" id="saveDepositBtn">Сохранить</button>
            </div>
        </div>
    </div>

    <script src="parser.js"></script>
    <script src="storage.js"></script>
    <script src="receipts-manager.js"></script>
    <script src="balances-manager.js"></script>
    <script src="app.js"></script>
</body>
</html>
